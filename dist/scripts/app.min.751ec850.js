"use strict";var app=angular.module("moviesApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","LocalStorageModule"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html"}).when("/movies/genre/:genre_id",{templateUrl:"views/movies.html",controller:"MoviesCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope","$rootScope","localStorageService","apiService","mainService",function(a,b,c,d,e){e.storeApiConfigData(),e.storeGenresData()}]),app.controller("MoviesCtrl",["$scope","$routeParams","apiService","mainService",function(a,b,c,d){var e=b;console.log("params: ",e),d.storeApiConfigData().then(function(b){console.log(b),a.images_base_url=b.images.base_url}),d.getGenreData(e.genre_id).then(function(b){a.genre_name=b.name}),c.getGenreMoviesList(e).then(function(b){var c=d.groupArray({num:4,array:b.results});b.results=c,a.moviesList=b.results,console.log(b.results)})}]),app.controller("GenresListCtrl",["$scope","$rootScope","localStorageService","apiService","mainService",function(a,b,c,d,e){var f=c.get("movieGenres");f?(a.genresList=f,console.log(f)):d.getGenresList().then(function(b){console.log("movie genres retrived, stored and broadcasted"),a.genresList=b.genres}),a.saveGenre=function(a){console.log(a)}}]),app.factory("apiService",["$http","$q","$rootScope",function(a,b,c){function d(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function e(a){return a.data}function f(b){var c=i.path.genre_id_movies.replace("{id}",b.genre_id),f=a({method:"get",url:i.base_url+c,params:{page:"1",api_key:i.api_key}}),g=f.then(e,d);return g}function g(){var b=a({method:"get",url:i.base_url+i.path.genre_movie_list,params:{api_key:i.api_key}}),c=b.then(e,d);return c}function h(){var b=a({method:"get",url:i.base_url+i.path.configuration,params:{api_key:i.api_key}}),c=b.then(e,d);return c}var i={api_key:"f77872cef86d6b860440a3b570e542b0",base_url:"http://api.themoviedb.org/3",path:{configuration:"/configuration",genre_movie_list:"/genre/movie/list",genre_id_movies:"/genre/{id}/movies"}};return{getGenresList:g,getGenreMoviesList:f,getApiConfig:h}}]),app.factory("mainService",["$http","$q","$rootScope","localStorageService","apiService",function(a,b,c,d,e){function f(){var a=b.defer(),c=d.get("apiConfig");return c?(console.log("api Config available in localstorage"),a.resolve(c)):e.getApiConfig().then(function(b){d.add("apiConfig",b),a.resolve(b),console.log("api Config stored")}),a.promise}function g(){var a=b.defer(),c=d.get("movieGenres");return c?(console.log("movie genres available in localstorage"),a.resolve(c)):e.getGenresList().then(function(b){d.add("movieGenres",b.genres),a.resolve(b.genres),console.log("movie genres stored")}),a.promise}function h(a){var c=b.defer(),d=parseInt(a);return g().then(function(a){for(var b=0;b<a.length;b++)if(a[b].id===d)return void c.resolve(a[b])}),c.promise}function i(a){for(var b=[],c=[],d=0;d<=a.array.length;d++)d>0&&d%a.num===0&&(b.push(c),c=[]),c.push(a.array[d]);return b}return{groupArray:i,storeGenresData:g,storeApiConfigData:f,getGenreData:h}}]),app.directive("genresThumbList",function(){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"directives/genres-thumb-list.html",controller:"GenresListCtrl"}});