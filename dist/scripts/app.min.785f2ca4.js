"use strict";var app=angular.module("moviesApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","LocalStorageModule"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html"}).when("/movies/genre/:with_genres",{templateUrl:"views/movies.html",controller:"MoviesCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope","$rootScope","localStorageService","apiService","utilsService","$window",function(a,b,c,d,e,f){function g(){var a=angular.element(f);a.bind("resize",function(){console.log("resize",a)})}d.storeApiConfigData(),d.storeGenresData(),g()}]),app.controller("MoviesCtrl",["$scope","$routeParams","apiService","utilsService",function(a,b,c,d){var e=b;console.log("params: ",e),c.getGenreData(e.with_genres).then(function(b){a.genre_name=b.name})}]),app.controller("GenresListCtrl",["$scope","$rootScope","localStorageService","apiService","utilsService",function(a,b,c,d,e){var f=c.get("movieGenres");f?(a.genresList=f,console.log(f)):d.getGenresList().then(function(b){console.log("movie genres retrived, stored and broadcasted"),a.genresList=b.genres}),a.saveGenre=function(a){console.log(a)}}]),app.factory("apiService",["$http","$q","$rootScope","localStorageService",function(a,b,c,d){function e(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function f(a){return a.data}function g(){var a=b.defer(),c=d.get("apiConfig");return c?(console.log("api Config available in localstorage"),a.resolve(c)):apiService.getApiConfig().then(function(b){d.add("apiConfig",b),a.resolve(b),console.log("api Config stored")}),a.promise}function h(){var a=b.defer(),c=d.get("movieGenres");return c?(console.log("movie genres available in localstorage"),a.resolve(c)):apiService.getGenresList().then(function(b){d.add("movieGenres",b.genres),a.resolve(b.genres),console.log("movie genres stored")}),a.promise}function i(b){var c=b;c.page="1",c.api_key=n.api_key,console.log("requestParams",c);var d=a({method:"get",url:n.base_url+n.path.discover_movies,params:c}),g=d.then(f,e);return g}function j(b){var c=n.path.genre_id_movies.replace("{id}",b.genre_id),d=a({method:"get",url:n.base_url+c,params:{page:"1",api_key:n.api_key}}),g=d.then(f,e);return g}function k(){var b=a({method:"get",url:n.base_url+n.path.genre_movie_list,params:{api_key:n.api_key}}),c=b.then(f,e);return c}function l(){var b=a({method:"get",url:n.base_url+n.path.configuration,params:{api_key:n.api_key}}),c=b.then(f,e);return c}function m(a){var c=b.defer(),d=parseInt(a);return h().then(function(a){for(var b=0;b<a.length;b++)if(a[b].id===d)return void c.resolve(a[b])}),c.promise}var n={api_key:"f77872cef86d6b860440a3b570e542b0",base_url:"http://api.themoviedb.org/3",path:{configuration:"/configuration",genre_movie_list:"/genre/movie/list",genre_id_movies:"/genre/{id}/movies",discover_movies:"/discover/movie"}};return{getGenresList:k,getMoviesList:i,getGenreMoviesList:j,getApiConfig:l,getGenreData:m,storeApiConfigData:g,storeGenresData:h}}]),app.factory("utilsService",["$http","$q","$rootScope","localStorageService",function(a,b,c,d){function e(a){for(var b=[],c=[],d=0;d<=a.array.length;d++)d>0&&d%a.num===0&&(b.push(c),c=[]),c.push(a.array[d]);return b}return{groupArray:e}}]),app.directive("genresMenu",function(){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"directives/genres-menu.html",controller:"GenresListCtrl"}}),app.directive("genresThumbList",function(){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"directives/genres-thumb-list.html",controller:"GenresListCtrl"}}),app.directive("featuredMovie",function(){var a=function(a,b,c){var d={};"true"===a.localParams?d.with_genres=a.genreId?a.genreId:null:d=b,c.storeApiConfigData().then(function(b){a.images_base_url=b.images.base_url}),c.getGenreData(d.with_genres).then(function(b){a.genre_name=b.name}),c.getMoviesList(d).then(function(b){var c=Math.floor(Math.random()*b.results.length+1);a.featured_movie=b.results[c]})};return{restrict:"E",transclude:!0,replace:!0,scope:{localParams:"@localParams",backdropSize:"@backdropSize",genreId:"@genreId"},templateUrl:"directives/featured-movie.html",controller:["$scope","$routeParams","apiService",a]}}),app.directive("movieGrid",function(){var a=function(a,b,c,d){var e={};"true"===a.localParams?(e.with_genres=a.genreId?a.genreId:null,e.sort_by=a.sortBy?a.sortBy:null):e=b,console.log(a.mikeInfo),c.storeApiConfigData().then(function(b){a.images_base_url=b.images.base_url}),c.getGenreData(e.with_genres).then(function(b){a.genre_name=b.name}),c.getMoviesList(e).then(function(b){var c=parseInt(a.groupItems),e=d.groupArray({num:c,array:b.results});a.moviesList=e,console.log(e)})};return{restrict:"E",transclude:!0,replace:!0,scope:{localParams:"@localParams",posterSize:"@posterSize",groupItems:"@groupItems",genreId:"@genreId",sortBy:"@",showInfo:"@"},templateUrl:"directives/movie-grid.html",controller:["$scope","$routeParams","apiService","utilsService",a]}}),app.directive("mapFontSize",["$window","$document",function(a,b){function c(a){var c=b[0].body,d=c.clientWidth,e={"font-size":d/21.16};a.css(e)}return function(b,d,e){var f=angular.element(a),g=angular.element(document);g.ready(function(){c(d)}),f.bind("resize",function(){c(d)})}}]);